legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
explore(df, 'ite')
explore(df, 'ice')
library(sf)
library(geobr)
library(ggplot2)
library(readxl)
library(ggspatial)
library(magrittr)
library(raster)
library(tmap)
## dados
df = read_excel('esg_agua.xlsx')
df = as.data.frame( df)
df[df$mun=='Jundiaí'& df$ano==2007,'ite'] = 100
## rename
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
## print os velhos e novos nomes das colunas
pnames = function(){
for (i in 1:length(or_names)) {
cat( or_names[i], '----- Novo nome:', new_names[i], '\n')
}
}
pnames()
# renomeando
for (i in 1:length(new_names)) {
colnames(df)[i] = new_names[i]
}
df = df[order(df$mun), ]
## change variables
#df$pop_tot_a  = df$pop_tot_a / df$pop_tot
#df$pop_tot_e  = df$pop_tot_e / df$pop_tot
# geocode
sp = read_municipality(code_muni = 'SP')
sp = sp[order(sp$name_muni), ]
## summary
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$ano==2000+i, x ]))
}
}
explore(df, 'ite')
box = st_bbox(sp$geom)
xrange <- box$xmax - box$xmin # range of x values
yrange <- box$ymax - box$ymin # range of y value
box[1] <- box[1] - (0.1 * xrange) # xmin - left
box[3] <- box[3] + (0.1 * xrange) # xmax - right
box[2] <- box[2] - (0.1 * yrange) # ymin - bottom
box[4] <- box[4] + (0.1 * yrange) # ymax - top
box =  box  %>% st_as_sfc()
## filter data
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt, ]$ice
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title='ice',  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
G_ice0
maps_f = function(){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt, ]$ice
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title='ice',  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
}
maps_f()
maps_f = function(x){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt, ]$x
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title='ice',  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
}
maps_f(ite)
maps_f = function(x){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt,x ]
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title='ice',  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
}
maps_f(ite)
maps_f('ite')
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title= x,  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
maps_f = function(x){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt,x ]
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title= x,  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_ice",i, ".png", sep = "") )
}
}
maps_f('ite')
maps_f = function(x){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt,x ]
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title= x,  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G",x, i, ".png", sep = "") )
}
}
maps_f('ite')
df[df$ite>100,'ite']
df[df$ite>100&df$ano==2007,'ite']
df = as.data.frame(df)
df[df$mun=='Jundiaí'& df$ano==2007,'ite'] = 100
df = as.data.frame(df)
maps_f('ite')
maps_f('iaua')
maps_f('iata')
maps_f('iatera')
df2 =  df[df$ano==2018, c('ice', 'ite', 'iata')]
View(df2)
length(df2)
nrow(df2)
library(reshape2)
melt(data = df2, id.vars = "data1")
melt(data = df2)
data = melt(data = df2)
View(data)
t = ggplot(data = df2, aes(x=value))
t +  geom_histogram(binwidth = 10,  aes(fill=variable),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índice de Tratamento de Esgoto')
t +  geom_histogram(binwidth = 10,  aes(fill=variable),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índice de Tratamento de Esgoto')
t = ggplot(data = df2, aes(x=value))
t = ggplot(data = data, aes(x=value))
t +  geom_histogram(binwidth = 10,  aes(fill=variable),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índice de Tratamento de Esgoto')
t +  geom_histogram(binwidth = 10,  aes(fill=variable),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal()
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
toupper(new_names)
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
new_names = toupper(new_names)
## print os velhos e novos nomes das colunas
pnames = function(){
for (i in 1:length(or_names)) {
cat( or_names[i], '----- Novo nome:', new_names[i], '\n')
}
}
pnames()
# renomeando
for (i in 1:length(new_names)) {
colnames(df)[i] = new_names[i]
}
df = df[order(df$mun), ]
df[df$mun=='Jundiaí'& df$ano==2007,'ITE'] = 100
df = df[order(df$MUN), ]
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$ano==2000+i, x ]))
}
}
explore(df, 'ITE')
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$AN0==2000+i, x ]))
}
}
explore(df, 'ITE')
df$ANO
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$AN0==2000+i, x ]))
}
}
explore(df, 'ITE')
explore(df, 'ICE')
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$AN0==2000+i, x ]))
}
}
explore(df, 'ICE')
df = df[order(df$MUN), ]
df = df[order(df$MUN), ]
df[df$mun=='Jundiaí'& df$ano==2007,'ITE'] = 100
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$AN0==2000+i, x ]))
}
}
explore(df, 'ICE')
summary(df[df$AN0==2000, 'ITE' ])
df[, 'ITE']
View(df)
df[, 'ite']
rm(df[, 'ite'])
df = df[,-1]
View(df)
summary(df[df$AN0==2000, 'ITE'])
str(df)
summary(df[df$AN0==2001, 'ITE'])
df = read_excel('esg_agua.xlsx')
df = as.data.frame(df)
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
new_names = toupper(new_names)
pnames = function(){
for (i in 1:length(or_names)) {
cat( or_names[i], '----- Novo nome:', new_names[i], '\n')
}
}
for (i in 1:length(new_names)) {
colnames(df)[i] = new_names[i]
}
df = df[order(df$MUN), ]
df[df$mun=='Jundiaí'& df$ano==2007,'ITE'] = 100
df[df$MUN=='Jundiaí'& df$ano==2007,'ITE'] = 100
df = read_excel('esg_agua.xlsx')
df = as.data.frame(df)
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
new_names = toupper(new_names)
for (i in 1:length(new_names)) {
colnames(df)[i] = new_names[i]
}
View(df)
df = df[order(df$MUN), ]
df[df$MUN=='Jundiaí'& df$ANO==2007,'ITE'] = 100
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$AN0==2000+i, x ]))
}
}
explore(df, 'ICE')
summary(df[df$AN0==2001, 'ITE'])
mean(df[df$AN0==2001, 'ITE'])
mean(df[df$AN0==2001, 'ITE'], na.rm=T)
mean(df[df$AN0==2001, 'ITE'], nan.rm=T)
mean(df[df$AN0==2001, 'ITE'], na.rm=T)
str(df[df$AN0==2001, 'ITE'])
df$AN0
df$AN0 == 2001
df$AN0
str(df[ df$AN0 == 2001, 'ITE'])
View(df)
df$ANO
mean(df$ANO)
mean(df$ITE)
mean(df$ITE, na.rm=T)
str(df[df$AN0 == 2001, 'ITE'])
str(df[df$'AN0' == 2001, 'ITE'])
str(df[df$`AN0` == 2001, 'ITE'])
or_names = colnames(df)
new_names = c('cod', 'mun', 'est', 'ano', 'prest', 'serv', 'pop_urb_a', 'pop_urb_e',
'pop_urb_aI', 'pop_urb_eI', 'pop_tot', 'pop_urb', 'pop_tot_a', 'pop_urb_a',
'pop_tot_e', 'pop_urb_e', 'ice', 'ite', 'iaua', 'iauera', 'iauere', 'iata', 'iatera')
pnames = function(){
for (i in 1:length(or_names)) {
cat( or_names[i], '----- Novo nome:', new_names[i], '\n')
}
}
pnames()
for (i in 1:length(new_names)) {
colnames(df)[i] = new_names[i]
}
df = df[order(df$mun), ]
df[df$mun=='Jundiaí'& df$ano==2007,'ite'] = 100
explore = function(df, x){
for(i in 0:18){
cat('Ano:', 2000+i, '\n')
print(summary(df[df$ano==2000+i, x ]))
}
}
explore(df, 'ice')
maps_f = function(x){
for (i in 0:18) {
filt = df$ano == (2000+i )
sp$var = df[filt,x ]
g1 =  tm_shape(sp, bbox = box) +
tm_polygons('var',  title=toupper(x),  textNA = 'Sem dados') +
tm_compass(type = "8star", position = c("right", "bottom", size = 0.0)) +
tm_scale_bar(breaks = c(0, 100, 200, 300), text.size = 0.6) +
tm_layout(
legend.text.size = 0.8,
frame = T,
legend.format = list(text.separator = "-"))
nam =  paste("G_ice", i, sep = "")
assign(nam, g1)
tmap_save(g1, filename = paste("G_",x, i, ".png", sep = "") )
}
}
maps_f('iatera')
maps_f('ite')
maps_f('iaua')
maps_f('iata')
df2 =  df[df$ano==2018, c('ice', 'ite')]
data = melt(data = df2)
View(data)
colnames(data)
colnames(data)[1] = 'Índice'
g0 = ggplot(data = data, aes(x=value))
g1 = g0 +  geom_histogram(binwidth = 10,  aes(fill=variable),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal()
g1 + scale_fill_discrete(name = "Dose", labels = c("ICE", "ITE"))
g1 + scale_fill_discrete( labels = c("ICE", "ITE"))
g1
g0 = ggplot(data = data, aes(x=value))
g1 = g0 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal()
g1 + scale_fill_discrete( labels = c("ICE", "ITE"))
g1
g1 = g0 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = c("ICE", "ITE"))
g1 = g0 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = c("ICE", "ITE"))
ggsave(g1, 'histograma1.png')
ggsave('g1.png')
df3 =  df[df$ano==2018, c('iata')]
df3 = melt(data = df2)
View(df3)
df3 = melt(data = df3)
df3 =  df[df$ano==2018, c('iata')]
df3 = melt(data = df3)
View(df3)
df3 =  df[df$ano==2018, c('iata')]
reps('IATA', nrow(df3))
rep('IATA', nrow(df3))
nrow(df3)
rep('IATA', nrows(df3))
nrow(df3)
df3 = data.frame( df[df$ano==2018, c('iata')] )
rep('IATA', nrow(df3))
df3$Índice = rep('IATA', nrow(df3))
View(data)
colnames(df3)
colnames(df3)[1] = 'IATA'
g2 = ggplot(data = df3, aes(x=IATA))
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = c("ICE", "ITE"))
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = c("IATA"))
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = c("IATA"))
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = NULL)
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal() +
scale_fill_discrete( labels = NULL)
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal() +
scale_fill_discrete( legend = NULL)
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal(legend=NULL)
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal(legend.position='none')
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme(legend.position='none')
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme(legend.position='none')  +
theme_minimal()
g3
g3 = g2 +  geom_histogram(binwidth = 10,  aes(fill=Índice),
colour='black', position = 'stack') +
ylab('Quantidade de municípios') +
#  xlab('Índices') +
theme_minimal() +
theme(legend.position='none')
g3
ggsave('g3.png')
